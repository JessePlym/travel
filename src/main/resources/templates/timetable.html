<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
	<title>Timetable</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" type="text/css" href="css/css/bootstrap.min.css" th:href="@{css/css/bootstrap.min.css}">
</head>
<body>
	<div class="container">
		<h1>Timetable</h1>
		<div th:switch="${#authentication}? ${#authorization.expression('isAuthenticated()')} : ${false}">
			<form th:case="${true}"th:action="@{/logout}" method="post">
				<input type="submit" value="Log Out" class="btn btn-sm btn-danger"/>
			</form>
			<form th:case="${false}" th:action="@{/login}" method="get">
				<input type="submit" value="Log in" class="btn btn-sm btn-success"/>
				<span><a class="btn btn-sm btn-success">Sign up</a></span>
			</form>	
		</div>
		<div th:inline="text">Welcome [[${#httpServletRequest.remoteUser}]]</div>
		<div style="text-align: right; padding: 20px 0">
			<a href="/ownbookings">My bookings</a><br>
			<a sec:authorize="hasAuthority('ADMIN')" href="/allbookings">All bookings</a>
		</div>
		<div>Search by date</div>
		<table class="table">
			<tr>
				<th>From</th>
				<th>Destination</th>
				<th>Date</th>
				<th>Departure Time</th>
				<th>Arrival Time</th>
				<th>Train Type</th>
				<th></th>
				<th></th>
				<th></th>
			</tr>
			<tr th:each="trip : ${trips}">
				<td th:text="${trip.departure}"></td>
				<td th:text="${trip.destination}"></td>
				<td th:text="${#dates.format(trip.date, 'dd.MM.yyyy')}"></td>
				<td th:text="${trip.departureTime}"></td>
				<td th:text="${trip.arrivalTime}"></td>
				<td th:text="${trip.trainType.name}"></td>
				<td><a class="btn btn-danger" sec:authorize="hasAuthority('ADMIN')" th:href="@{/deletetrip/{id}(id=${trip.tripId})}">Delete</a></td>
				<td><a class="btn btn-success" sec:authorize="hasAuthority('ADMIN')" th:href="@{/edittrip/{id}(id=${trip.tripId})}">Edit</a></td>
				<td><a class="btn btn-primary" th:href="@{/booktrip/{id}(id=${trip.tripId})}">Book this trip</a></td>
			</tr>
		</table>
		<a class="btn btn-success" sec:authorize="hasAuthority('ADMIN')" href="/addtrip">Add new trip  </a>
		<a class="btn btn-success" sec:authorize="hasAuthority('ADMIN')" href="/addtype">Add new train type</a>
	</div>
</body>
</html>